function u(t,e=!1,n=1){const o=e?1e3:1024;if(Math.abs(t)<o)return t+" B";const a=e?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];let s=-1;const i=10**n;do t/=o,++s;while(Math.round(Math.abs(t)*i)/i>=o&&s<a.length-1);return t.toFixed(n)+" "+a[s]}function d(t){const e=t.src||t.href;if(e&&e.length>0){const n=performance.getEntriesByName(e)[0];if(typeof n<"u"){const o=t.parentNode.parentNode.parentNode.nextElementSibling.querySelector(".io-file-size");o&&(o.innerHTML=u(n.decodedBodySize,!0))}}}(function(t,e,n){const o="ImageOptimizeOptimizedImages",a={};function s(i,r){this.element=i,this.options=t.extend({},a,r),this._defaults=a,this._name=o,this.init()}s.prototype={init:function(){t(function(){const i=n.querySelectorAll("img.io-preview-image");for(const r of i)r.complete?d(r):r.addEventListener("load",c=>{d(c.target)})})}},t.fn[o]=function(i){return this.each(function(){t.data(this,"plugin_"+o)||t.data(this,"plugin_"+o,new s(this,i))})}})($,window,document);Craft.OptimizedImagesInput=Garnish.Base.extend({id:null,inputNamePrefix:null,inputIdPrefix:null,$container:null,$blockContainer:null,$addBlockBtnContainer:null,$addBlockBtnGroup:null,$addBlockBtnGroupBtns:null,blockSort:null,blockSelect:null,init:function(t,e){this.id=t,this.inputNamePrefix=e,this.inputIdPrefix=Craft.formatInputId(this.inputNamePrefix),this.$container=$("#"+this.id),this.$blockContainer=this.$container.children(".variant-blocks"),this.$addBlockBtnContainer=this.$container.children(".buttons"),this.$addBlockBtnGroup=this.$addBlockBtnContainer.children(".btngroup"),this.$addBlockBtnGroupBtns=this.$addBlockBtnGroup.children(".btn"),this.$blockContainer.find("> > .actions > .settings").each((o,a)=>{const s=$(a);let i;s.data("menubtn")?i=s.data("menubtn"):i=new Garnish.MenuBtn(a),i.menu.settings.onOptionSelect=$.proxy(function(r){this.onMenuOptionSelect(r,i)},this)});const n=this.$blockContainer.children();this.blockSort=new Garnish.DragSort(n,{handle:"> .actions > .move",axis:"y",collapseDraggees:!0,magnetStrength:4,helperLagBase:1.5,helperOpacity:.9,onSortChange:$.proxy(function(){this.resetVariantBlockOrder()},this)}),this.addListener(this.$addBlockBtnGroupBtns,"click",function(){this.addVariantBlock(null)}),this.addAspectRatioHandlers(),this.reIndexVariants()},onMenuOptionSelect:function(t,e){const n=$(t),o=e.$btn.closest(".matrixblock");switch(n.data("action")){case"add":{this.addVariantBlock(o);break}case"delete":{n.hasClass("disabled")||this.deleteVariantBlock(o);break}}},getHiddenBlockCss:function(t){return{opacity:0,marginBottom:-t.outerHeight()}},reIndexVariants:function(){this.$blockContainer=this.$container.children(".variant-blocks");const t=this.$blockContainer.children();t.each(function(n,o){const a=n,i=$(o).find("div .field, label, input, select");$(i).each(function(r,c){let l=$(c).attr("id");l&&(l=l.replace(/-([0-9]+)-/g,"-"+a+"-"),$(c).attr("id",l)),l=$(c).attr("for"),l&&(l=l.replace(/-([0-9]+)-/g,"-"+a+"-"),$(c).attr("for",l)),l=$(c).attr("name"),l&&(l=l.replace(/\[([0-9]+)]/g,"["+a+"]"),$(c).attr("name",l))})});let e=!1;t.length==1&&(e=!0),t.find("> .actions > .settings").each(function(n,o){const a=$(o);let s;if(a.data("menubtn")&&(s=a.data("menubtn"),typeof s.menu.$options<"u")){let i=$(s.menu.$options[1]);typeof i<"u"&&(e?i.addClass("disabled").disable():i.removeClass("disabled").enable())}})},addAspectRatioHandlers:function(){this.addListener($(".lightswitch"),"click",function(t){$(t.target).closest(".matrixblock").find(".io-aspect-ratio-wrapper").slideToggle()}),this.addListener($(".io-select-ar-box"),"click",function(t){const e=$(t.target);let n=$(t.target).data("x"),o=$(t.target).data("y"),a=$(t.target).data("custom"),s,i;i=e.closest(".matrixblock"),i.find(".io-select-ar-box").each(function(r,c){$(c).removeClass("io-selected-ar-box")}),e.addClass("io-selected-ar-box"),a?i.find(".io-custom-ar-wrapper").slideDown():(i.find(".io-custom-ar-wrapper").slideUp(),s=i.find("input")[2],$(s).val(n),s=i.find("input")[3],$(s).val(o))})},addVariantBlock:function(t){let e=$(this.$blockContainer.children()[0]).clone();e.find(".io-select-ar-box").each((o,a)=>{o===0?$(a).addClass("io-selected-ar-box"):$(a).removeClass("io-selected-ar-box")}),e.find(".io-custom-ar-wrapper").hide();let n=e.find("input")[0];$(n).val(1200),n=e.find("input")[1],$(n).val(1),n=e.find("input")[2],$(n).val(16),n=e.find("input")[3],$(n).val(9),n=e.find("select")[0],$(n).val(82),n=e.find("select")[1],$(n).val("jpg"),e.css(this.getHiddenBlockCss(e)).velocity({opacity:1,"margin-bottom":10},"fast",$.proxy(function(){t?e.insertBefore(t):e.appendTo(this.$blockContainer),this.blockSort.addItems(e),this.addAspectRatioHandlers(),e.find(".settings").each((o,a)=>{let s=$(a),i,r;r=this.$container.find(".io-menu-clone > .menu").clone(),$(r).insertAfter(s),i=new Garnish.MenuBtn(a),i.menu.settings.onOptionSelect=$.proxy(function(c){this.onMenuOptionSelect(c,i)},this)}),this.reIndexVariants()},this))},deleteVariantBlock:function(t){t.velocity(this.getHiddenBlockCss(t),"fast",$.proxy(()=>{t.remove(),this.reIndexVariants()},this))},resetVariantBlockOrder:function(){this.reIndexVariants()}});$(document).ready(function(){const t=new CustomEvent("vite-script-loaded",{detail:{path:"../src/web/assets/src/js/OptimizedImagesField.js"}});document.dispatchEvent(t)});
//# sourceMappingURL=field-D_XkB3eu.js.map
